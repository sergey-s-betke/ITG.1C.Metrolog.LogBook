\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{gost6.38}[2014/10/22 v0.1 GOST 6.38-90]

\RequirePackage[T2A,T1]{fontenc}

\newcommand*{\signatureStampTitle}[1]{%
	\centering%
	\textbf{
		\MakeUppercase{#1}
	}
	\par
	\vspace{2ex minus 0.5ex}
}

% собственно гриф документа
\newcommand{\signatureStamp@Title}[1]{%
	\par{\signatureStampTitle{#1}\par}
}

\newcommand*{\signatureStampPost}[1]{#1}

% должность в грифе документа
\newcommand{\signatureStamp@Post}[1]{%
	\par{\signatureStampPost{#1}\par}
}

% графа с пояснением
\newcommand{\annotatedField}[3]{%
	{%
		\parbox[t]{#1}{%
			\centering#2\\%
			\renewcommand{\baselinestretch}{1}\selectfont%
			\vspace{-0.2ex}%
			\tiny#3%
		}%
	}
}

\newlength\@annotatedFieldWidth@t
\newlength\@annotatedFieldWidth

% ФИО и подпись в грифе документа
\newcommand{\annotatedFieldLine}[3]{%
	{%
		\par%
		\settowidth{\@annotatedFieldWidth@t}{ #2}%
		\setlength{\@annotatedFieldWidth}{\linewidth}%
		\addtolength{\@annotatedFieldWidth}{-\@annotatedFieldWidth@t}%
		\annotatedField{\@annotatedFieldWidth}{#1}{#3}%
		\hfill#2%
		\par%
	}
}

\newcommand*{\signatureStampName}[1]{#1}

% ФИО и подпись в грифе документа
\newcommand{\signatureStamp@NameAndSignature}[1]{%
	\annotatedFieldLine%
		{\hrulefill}%
		{{\signatureStampName{#1}}}%
		{подпись}%
}

% Шаблон даты
\newcommand{\dateTemplate}[0]{%
	<<\rule{2em}{.4pt}>>~\rule{10em}{.4pt}~\rule{4em}{.4pt}%
}

\newlength\@dateTemplateWidth
		
% Дата подписи в грифе документа
\newcommand{\signatureStamp@Date}[1]{%
	{%
		\par\centering%
		\settowidth{\@dateTemplateWidth}{\dateTemplate}%
		\annotatedField{\@dateTemplateWidth}{\dateTemplate}{дата}%
		\par%
	}
}

% только виза в грифе документа по п.1.4
% #1 - должность 
% #2 - ФИО
% #3 - дата
\newcommand{\signatureStampVisa}[3]{%
	\signatureStamp@Post{#1}%
	\signatureStamp@NameAndSignature{#2}%
	\signatureStamp@Date{#3}%
	\vspace{2ex plus 1ex minus 1ex}
}

% гриф документа по п.1.4
% #1 - собственно гриф (Утверждаю, Согласовано и т.д.)
% #2 - должность 
% #3 - ФИО
% #4 - дата
\newcommand{\signatureStamp}[4]{%
	\signatureStamp@Title{#1}%
	\signatureStampVisa{#2}{#3}{#4}%
}

\newlength\@signatureStampBoxW
\setlength{\@signatureStampBoxW}{15em}

\newcommand{\signatureStampVisaBox}[3]{%
	\parbox[t]{\@signatureStampBoxW}{%
		\signatureStampVisa{#1}{#2}{#3}%
	}
}

\newcommand{\signatureStampBox}[4]{%
	\parbox[t]{\@signatureStampBoxW}{%
		\signatureStamp{#1}{#2}{#3}{#4}%
	}
}
