\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{gost2.105.text}[2014/10/29 v0.1 ГОСТ 2.105-95 ЕСКД. Общие требования к текстовым документам. Текст]

\DeclareOption*{%
	\PassOptionsToPackage{\CurrentOption}{eskdsect}%
}

\ExecuteOptions{pointsubsubsection}

\ProcessOptions\relax

\RequirePackage{ifxetex}
\RequireXeTeX

\RequirePackage{xecyr}

\RequirePackage[cyremdash]{extdash}

\RequirePackage[T2A,T1]{fontenc}

\RequirePackage{amsmath,amsthm,amssymb}
\RequirePackage{mathtext}
\RequirePackage{unicode-math}

\RequirePackage[russian]{translator}
\RequirePackage{gensymb}
\RequirePackage[sepfour]{numprint}
\RequirePackage{siunitx}
\sisetup{range-phrase=\space до~} 

\RequirePackage{url} 
\RequirePackage[unicode=true]{hyperref} 

\hypersetup{ %
	breaklinks=true 
	,bookmarks=true 
	,pdfauthor={Sergey S. Betke}
	,pdftitle={title}
	,colorlinks=false 
	% ,citecolor=blue
	% ,urlcolor=blue
	% ,linkcolor=magenta
	,pdfborder={0 0 0}
}
\urlstyle{same}  % don't use monospace font for urls

\RequirePackage{eskdsect}
\RequirePackage{eskdpara}


\setlength{\parskip}{0mm plus 1mm}


\setcounter{secnumdepth}{5}


\newlength{\betweenheadersskip}
\setlength{\betweenheadersskip}{8mm plus 3mm minus 0mm - \baselineskip}


\setlength{\ESKDsectionSkipBefore}{-15mm plus -4mm minus -2mm + \baselineskip}
\setlength{\ESKDsectionSkipAfter}{15mm plus 0mm minus 2mm - \baselineskip}


\setlength{\ESKDsubsectionSkipBefore}{-15mm plus -3mm minus -1mm + \baselineskip}
\setlength{\ESKDsubsectionSkipAfter}{15mm plus 0mm minus 3mm - \baselineskip}

\renewcommand\thesubsection{%
	\ifnum\value{subsection}=\z@%
		\thesection%
	\else%
		\thesection.\arabic{subsection}%
	\fi%}
}


\setlength{\ESKDsubsubsectionSkipBefore}{-15mm plus -3mm minus -1mm + \baselineskip}
\setlength{\ESKDsubsubsectionSkipAfter}{15mm plus 0mm minus 3mm - \baselineskip}

\renewcommand\thesubsubsection{%
	\ifnum\value{subsubsection}=\z@%
		\thesubsection%
	\else%
		\thesubsection.\arabic{subsubsection}%
	\fi%}
}
\@addtoreset{subsubsection}{section}

\@addtoreset{paragraph}{section}
\@addtoreset{paragraph}{subsection}
\@addtoreset{paragraph}{subsubsection}

\renewcommand{\ESKDparagraphAlign}{\ESKDsectAlignLeft}
\renewcommand{\ESKDparagraphStyle}{\normalfont\normalsize}
\setlength{\ESKDparagraphSkipBefore}{0mm plus 2mm}
\setlength{\ESKDparagraphSkipAfter}{-0mm}


\@addtoreset{subparagraph}{section}
\@addtoreset{subparagraph}{subsection}
\@addtoreset{subparagraph}{subsubsection}

\renewcommand{\ESKDsubparagraphAlign}{\ESKDsectAlignLeft}
\renewcommand{\ESKDsubparagraphStyle}{\normalfont\normalsize}
\setlength{\ESKDsubparagraphSkipBefore}{0mm plus 1mm}
\setlength{\ESKDsubparagraphSkipAfter}{-0mm}


\def\@startsection#1#2#3#4#5#6{%
	\if@noskipsec \leavevmode \fi
	\par
	\@tempskipa #4\relax
	\@afterindenttrue
	\ifdim \@tempskipa <\z@
		\@tempskipa -\@tempskipa \@afterindentfalse
	\fi
	\if@nobreak % предыдущий абзац - "полноценный" (отдельным абзацем идёт) заголовок
		\everypar{}%
		\@tempskipa #5\relax
		\ifdim \@tempskipa>\z@ % этот заголовок - так же "полноценный"
			\vskip -\lastskip % убираем лишний отступ между заголовками (п.4.1.9 ГОСТ 2.105)
			\vskip \betweenheadersskip
		\fi
	\else
		\addpenalty\@secpenalty\addvspace\@tempskipa
	\fi
	\@ifstar
		{\@ssect{#3}{#4}{#5}{#6}}%
		{\@dblarg{\@sect{#1}{#2}{#3}{#4}{#5}{#6}}}%
}
