\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{gost2.105.table}[2014/12/04 v0.1 ГОСТ 2.105-95 ЕСКД. Общие требования к текстовым документам. Таблицы]

\ProcessOptions\relax

\RequirePackage{longtable}

\RequirePackage{tabu}

\RequirePackage{afterpage}

\RequirePackage{pdflscape}


\newtoks\@gost@table@data

\newcommand\resettabledata{%
	\global\@gost@table@data{}%
}
\resettabledata

\newcommand*\addtabledata[1]{%
	\global\@gost@table@data\expandafter{\the\@gost@table@data#1}%
}

\newcommand*\eaddtabledata[1]{%
	\edef\reserved@a{\the\@gost@table@data#1}%
	\global\@gost@table@data\expandafter{\reserved@a}%
}

\newcommand\flushtabledata{%
	\the\@gost@table@data%
}


\newtabulinestyle{outer=\ESKDlineThick}
\newtabulinestyle{inner=\ESKDlineThin}
\tabulinestyle{inner}
\tabulinesep=1mm
% todo min row height=8mm % п. 4.4.5

\DeclareTextCommandDefault{\@gost@table@tobecontinued}{Продолжение таблицы на следующей странице}
\DeclareTextCommandDefault{\@gost@table@continuation}{Продолжение таблицы}

% #1 - caption
% #2 - label
% #3 - preamble without start and finish |
% #4 - header line without \\
\newenvironment{gost2.105.table}[4]{
	\begin{longtabu}[c]
		{|[outer]#3|[outer]}
		\caption{#1\label{#2}}                                                   \\
		\tabucline[outer]{-}%
		#4                                                                       \\\tabucline[outer]{-}
		\endfirsthead
		\caption*{\@gost@table@continuation}                                     \\
		\tabucline[outer]{-}%
		#4                                                                       \\\tabucline[outer]{-}
		\endhead
		\tabucline[outer]{-}
		\multicolumn{\the\LT@cols}{r}{\@gost@table@tobecontinued}                \\
		\endfoot
		\tabucline[outer]{-}%
		\endlastfoot
		%\everyrow{\tabucline{-}}
}{
		\tabuphantomline
	\end{longtabu}
}
